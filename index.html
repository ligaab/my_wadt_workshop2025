<!DOCTYPE html>
<html lang="lv">
<head>
    <meta charset="UTF-8" />
    <title>F1 Sacensības ar parametriem</title>

    <!-- jQuery bibliotēka -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #eee;
            margin: 0;
            padding: 20px;
        }

        .track {
            position: relative;
            height: 140px;
            margin-bottom: 30px;
            background: #ccc;
            border-radius: 10px;
            overflow: hidden;
            padding-top: 10px;
        }

        .car {
            position: absolute;
            top: 40px;
            left: 0;
            width: auto;
            display: block;
            user-select: none;
            transition: height 0.3s ease;
        }

        .car-label {
            margin-left: 10px;
            font-weight: bold;
        }

        .inputs {
            margin-left: 110px;
            position: absolute;
            top: 10px;
        }

        .inputs label {
            margin-right: 15px;
            font-size: 14px;
        }

        #startButton {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 20px;
        }

        #winner {
            margin-top: 20px;
            font-size: 24px;
            font-weight: bold;
        }

        /* Ievades lauku stils */
        input[type="number"] {
            width: 60px;
            padding: 4px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

    </style>
</head>
<body>

    <h1>F1 Sacensības ar parametriem</h1>   

    <div class="track" id="track1">
        <img src="ligaab/my_wadt_workshop2025/pictures/car1.avif" class="car" id="car1" alt="Mašīna 1" style="height: 80px;">
        <div class="inputs">
            <span class="car-label">Mašīna 1</span>
            <label>Ātrums (ms): <input type="number" min="1000" max="8000" value="4000" id="speed1"></label>
            <label>Izmērs (px): <input type="number" min="40" max="150" value="80" id="size1"></label>
        </div>
    </div>

    <div class="track" id="track2">
        <img src="ligaab/my_wadt_workshop2025/pictures/car2.webp" class="car" id="car2" alt="Mašīna 2" style="height: 80px;">
        <div class="inputs">
            <span class="car-label">Mašīna 2</span>
            <label>Ātrums (ms): <input type="number" min="1000" max="8000" value="4000" id="speed2"></label>
            <label>Izmērs (px): <input type="number" min="40" max="150" value="80" id="size2"></label>
        </div>
    </div>

    <div class="track" id="track3">
        <img src="ligaab/my_wadt_workshop2025/pictures/car3.webp" class="car" id="car3" alt="Mašīna 3" style="height: 80px;">
        <div class="inputs">
            <span class="car-label">Mašīna 3</span>
            <label>Ātrums (ms): <input type="number" min="1000" max="8000" value="4000" id="speed3"></label>
            <label>Izmērs (px): <input type="number" min="40" max="150" value="80" id="size3"></label>
        </div>
    </div>

    <button id="startButton">Startēt sacensības</button>

    <div id="winner"></div>

    <script>
        const cars = [
            { id: "#car1", name: "Mašīna 1", speedInput: "#speed1", sizeInput: "#size1" },
            { id: "#car2", name: "Mašīna 2", speedInput: "#speed2", sizeInput: "#size2" },
            { id: "#car3", name: "Mašīna 3", speedInput: "#speed3", sizeInput: "#size3" }
        ];

        $("#startButton").on("click", () => {
            $("#winner").text("");

            // Atgriež katru auto sākuma pozīcijā, pielāgo izmēru un aptur iepriekšējās animācijas
            cars.forEach(car => {
                const speed = parseInt($(car.speedInput).val());
                const size = parseInt($(car.sizeInput).val());

                // Validācija - ja speed vai size nav derīgs, liek noklusējuma vērtību
                const speedMs = (speed >= 1000 && speed <= 8000) ? speed : 4000;
                const sizePx = (size >= 40 && size <= 150) ? size : 80;

                // Pielāgo auto izmēru
                $(car.id).stop(true).css({
                    left: 0,
                    height: sizePx + "px"
                });

                // Saglabā ātrumu auto objektā (lai varētu izmantot zemāk animācijai)
                car.speedMs = speedMs;
            });

            const finishLine = $(window).width() - 150;
            let results = [];

            cars.forEach(car => {
                // Animē atbilstoši lietotāja ievadītajam ātrumam
                $(car.id).animate(
                    { left: finishLine },
                    car.speedMs,
                    "linear"
                );

                results.push({ name: car.name, time: car.speedMs });
            });

            // Atrodi uzvarētāju pēc laikiem (mazākais laiks uzvar)
            const winner = results.sort((a, b) => a.time - b.time)[0];

            // Parādi uzvarētāju pēc max ātruma laika + 500ms, lai pārliecinātos, ka visas animācijas beigušās
            const maxTime = Math.max(...results.map(r => r.time));
            setTimeout(() => {
                $("#winner").text(`Uzvarētājs: ${winner.name}! 🏁`);
            }, maxTime + 500);
        });
    </script>

</body>
</html>